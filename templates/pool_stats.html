{% extends "base.html" %}
{% set active_page = "pool_stats" %}
{% set page_title = "Pool Stats - Efficiency and block information for Simple " ~ config['coin_name'] ~ " mining pool" %}
{% block body %}
<script>
$(document).ready(function() {
  {# Initial graph generation #}
  generate_graph($('#chart'), {address: 'pool'});
});
</script>

<div class="row row-header">
  <div class="col-lg-12">
    <h2>Pool Hashrate
    <div class="btn btn-default btn-sm collapse-button" data-toggle="collapse" data-target="#chart" id="hashrate-collapse">{% if hide_hr %}[+]{% else %}[-]{% endif %}</div>
    </h2>
    <div class="col-lg-12" id="chart">
      <ul class="nav nav-tabs">
        <li class="tab hour"><a>Hour</a></li>
        <li class="tab day"><a>Day</a></li>
        <li class="tab month"><a>Month</a></li>
      </ul>
      <div style="height:400px;">
        <img src="{{ config['assets_address'] | safe }}/img/712.GIF" style="position:absolute;padding-top:150px;padding-left:400px;"><svg></svg>
      </div>
    </div>
  </div>
</div>

{% if server_status %}
<br />
<div class="row page-header">
  <h2><i class="fa fa-cog"></i> &nbsp; Stratum Status</h2>
  <div class="col-lg-12">
    <div class="bs-example table-responsive">
      <table class="table table-striped table-hover tablesorter" id="blockTable">
        <thead>
          <tr>
            <th>Server</th>
            <th>Algo</th>
            <th>Chain</th>
            <th>Hashrate (last minute)</th>
            <th>Workers</th>
            <th>Miners</th>
          </tr>
        </thead>
        <tbody>
        {% for pp, data in server_status.iteritems() %}
        {% set pp = powerpools[pp] %}
        <tr>
          <th>{{ pp.stratum_address }} (diff {{pp.diff}})</th>
          <td>{{ pp.chain.algo.display }}</td>
          <td>{{ pp.chain.title }} ({{ pp.chain.type }})</td>
          <td>{{ data['hashrate'] | hashrate }}</td>
          <td>{{ "{:,}".format(data['workers']) }}</td>
          <td>{{ "{:,}".format(data['miners']) }}</td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endif %}

<br />
<div class="row row-header">
  <h2>Recently Mined Blocks</h2>
  <ul class="nav nav-tabs algo-tabs">
    <li class="tab active" data-algo="all">
      <a href="#">All Algos</a></li>
  {% for algo, currencies in network_data.iteritems() %}
    <li class="tab" data-algo="{{ algo }}"><a href="#">{{ algo }}</a></li>
  {% endfor %}
  </ul>

  <div class="col-lg-12 collapse {% if not hide_hr %}in{% endif %}" id="chart" style="border-top:1px solid #4e5d6c;">

  {% for algo, currencies in network_data.iteritems() %}

  {# Pass the outer loop index into the blocks_table.html #}
  {% set index = loop.index0 %}

  <div class="row algo {{ algo }}">
    <div class="col-lg-12 no-padding">

      {% for currency, data in currencies.iteritems() %}
      <div class="row" style="margin-top:25px;padding-left:15px;padding-right:15px;">
        <div class="col-lg-2">
          <h3>{{ currency.name }}</h3>
        </div>
        <div class="col-lg-5">
          <dl class="dl-horizontal">
            <dt>Code</dt>
            <dd>{{ currency.key }}</dd>
            <dt>Algorithm</dt>
            <dd>{{ algo }}</dd>
          {% if 'avg_difficulty' in data %}
            <dt>Average Difficulty</dt>
            <dd>{{ data['avg_difficulty'] | comma }}</dd>
          {% endif %}
          </dl>
        </div>
        <div class="col-lg-5">
          <dl class="dl-horizontal">
            <dt>Current Hashrate</dt>
            <dd>{{ data['hashrate'] | hashrate }}</dd>
            {% if 'start_time' in data['round'] %}
            <dt>Last Solve</dt>
            <dd>{{ data['round']['start_time'] | human_date_utc }}</dd>
            {% endif %}
          </dl>
        </div>
      </div>
      <div class="row">
        {% if data['blocks'] %}
          {% set blocks = data['blocks'] %}
          {% set current_block = data['round'] %}
          {% include "block_table.html" %}
        {% endif %}
      </div>
      <div class="well well-sm" style="text-align:center;background-color:#212F3D;margin-top:-21px;margin-bottom:0px;">
        <h4><small><a href="/blocks/{{ currency }}">
          View more {{ currency.name }} blocks
        </a></small></h4>
      </div>
      {% endfor %}
    </div>
  </div>
    {% endfor %}

  </div>
</div>
{% endblock %}
